organ_systems = {
'Сердечно-сосудистая система': {
'organs': ['сердце', 'кровеносные сосуды', 'артерии', 'вены', 'капилляры', 'аорта'],
'symptoms': [
    'боль в грудной клетке давящего характера',
    'ощущение перебоев в работе сердца',
    'учащенное сердцебиение в покое',
    'одышка при обычной физической нагрузке',
    'отеки на ногах к вечеру',
    'головокружение при смене положения тела',
    'повышение артериального давления',
    'снижение толерантности к физической нагрузке',
    'бледность кожных покровов',
    'похолодание конечностей'
        ]
    },
'Дыхательная система': {
'organs': ['легкие', 'бронхи', 'трахея', 'гортань', 'носоглотка', 'альвеолы'],
'symptoms': [
    'кашель с отделением мокроты',
    'сухой надсадный кашель',
    'одышка в покое',
    'боли в грудной клетке при дыхании',
    'хрипы в грудной клетке',
    'ночные приступы удушья',
    'кровохарканье',
    'повышение температуры тела с ознобом',
    'боль в горле',
    'заложенность носа'
        ]
    },
'Пищеварительная система': {
'organs': ['желудок', 'кишечник', 'печень', 'поджелудочная железа', 'желчный пузырь', 'пищевод'],
'symptoms': [
    'боли в животе спастического характера',
    'тошнота после приема пищи',
    'рвота съеденной пищей',
    'изжога после острой пищи',
    'вздутие живота',
    'нарушение стула (запоры/диарея)',
    'отрыжка воздухом',
    'снижение аппетита',
    'боль в правом подреберье',
    'желтушность кожных покровов'
        ]
    },
'Нервная система': {
'organs': ['головной мозг', 'спинной мозг', 'периферические нервы', 'мозжечок', 'ствол мозга'],
'symptoms': [
    'головная боль напряжения',
    'мигренозные боли с аурой',
    'головокружение системного характера',
    'онемение конечностей',
    'слабость в руках/ногах',
    'нарушение координации движений',
    'шум в ушах',
    'нарушение памяти',
    'тремор конечностей',
    'нарушение речи'
        ]
    },
'Опорно-двигательная система': {
'organs': ['кости', 'суставы', 'мышцы', 'связки', 'позвоночник', 'хрящи'],
'symptoms': [
    'боли в суставах при движении',
    'утренняя скованность в суставах',
    'боли в пояснице при нагрузке',
    'ограничение подвижности в суставах',
    'мышечные боли после физической нагрузки',
    'хруст в суставах при движении',
    'отечность суставов',
    'ночные боли в костях',
    'деформация суставов',
    'слабость в мышцах'
        ]
    },
'Мочеполовая система': {
'organs': ['почки', 'мочевой пузырь', 'мочеточники', 'уретра', 'надпочечники'],
'symptoms': [
    'боли в поясничной области',
    'нарушение мочеиспускания',
    'частые позывы к мочеиспусканию',
    'боли при мочеиспускании',
    'изменение цвета мочи',
    'отеки на лице по утрам',
    'боли внизу живота',
    'нарушение менструального цикла',
    'патологические выделения',
    'нарушение эрекции'
        ]
    },
'Эндокринная система': {
'organs': ['щитовидная железа', 'надпочечники', 'поджелудочная железа', 'гипофиз', 'гипоталамус'],
'symptoms': [
    'повышенная жажда',
    'учащенное мочеиспускание',
    'повышенный аппетит',
    'снижение массы тела',
    'повышенная потливость',
    'нарушение терморегуляции',
    'изменение настроения',
    'нарушение роста волос',
    'изменение тембра голоса',
    'нарушение менструального цикла'
        ]
    },
'Кожа и придатки': {
'organs': ['кожа', 'ногти', 'волосы', 'потовые железы', 'сальные железы'],
'symptoms': [
    'кожные высыпания',
    'зуд кожных покровов',
    'шелушение кожи',
    'изменение цвета кожных покровов',
    'появление новообразований',
    'выпадение волос',
    'ломкость ногтей',
    'повышенная потливость',
    'сухость кожи',
    'пигментация кожи'
        ]
    },
'Органы чувств': {
'organs': ['глаза', 'уши', 'нос', 'язык', 'вестибулярный аппарат'],
'symptoms': [
    'снижение остроты зрения',
    'боль в глазах',
    'покраснение глаз',
    'ощущение песка в глазах',
    'двоение в глазах',
    'слезотечение',
    'снижение слуха',
    'шум в ушах',
    'нарушение обоняния',
    'нарушение вкуса'
        ]
    },
'Иммунная система': {
'organs': ['лимфатические узлы', 'селезенка', 'костный мозг', 'тимус', 'миндалины'],
'symptoms': [
    'увеличение лимфатических узлов',
    'частые инфекционные заболевания',
    'аллергические реакции',
    'повышение температуры тела',
    'слабость и утомляемость',
    'ночная потливость',
    'снижение массы тела',
    'боли в костях',
    'склонность к кровотечениям',
    'длительное заживление ран'
        ]
    },
'Женская половая система': {
'organs': ['матка', 'яичники', 'влагалище', 'фаллопиевы трубы', 'молочные железы'],
'symptoms': [
    'нарушение менструального цикла',
    'боли внизу живота',
    'патологические выделения из влагалища',
    'болезненность молочных желез',
    'образование уплотнений в груди',
    'зуд в области половых органов',
    'боли при половом акте',
    'нарушение репродуктивной функции',
    'приливы жара',
    'сухость влагалища'
        ]
    },
'Мужская половая система': {
'organs': ['предстательная железа', 'яички', 'половой член', 'семенные пузырьки'],
'symptoms': [
    'нарушение мочеиспускания',
    'боли в промежности',
    'снижение либидо',
    'нарушение эрекции',
    'боли при эякуляции',
    'изменение качества спермы',
    'уплотнения в яичках',
    'боли в мошонке',
    'преждевременная эякуляция',
    'снижение фертильности'
        ]
    },
'Кровь и кроветворная система': {
'organs': ['кровь', 'костный мозг', 'селезенка', 'лимфатические узлы'],
'symptoms': [
    'бледность кожных покровов',
    'повышенная утомляемость',
    'одышка при нагрузке',
    'учащенное сердцебиение',
    'склонность к кровотечениям',
    'образование синяков',
    'увеличение лимфатических узлов',
    'ночная потливость',
    'повышение температуры тела',
    'потеря веса'
        ]
    },
'Лимфатическая система': {
'organs': ['лимфатические сосуды', 'лимфатические узлы', 'миндалины', 'аденоиды'],
'symptoms': [
    'увеличение лимфатических узлов',
    'отеки конечностей',
    'боли в области лимфоузлов',
    'повышение температуры тела',
    'слабость и недомогание',
    'ночная потливость',
    'потеря веса',
    'частые инфекции',
    'покраснение кожи над лимфоузлами',
    'ощущение тяжести в конечностях'
        ]
    },
'Психическая сфера': {
'organs': ['психика', 'эмоциональная сфера', 'когнитивные функции'],
'symptoms': [
    'снижение настроения',
    'повышенная тревожность',
    'нарушение сна',
    'апатия и безразличие',
    'раздражительность',
    'панические атаки',
    'навязчивые мысли',
    'снижение концентрации внимания',
    'нарушение памяти',
    'изменение поведения'
        ]
    },
'Стоматологическая система': {
'organs': ['зубы', 'десны', 'язык', 'слизистая полости рта', 'челюсти'],
'symptoms': [
    'зубная боль',
    'кровоточивость десен',
    'повышенная чувствительность зубов',
    'неприятный запах изо рта',
    'образование язвочек во рту',
    'подвижность зубов',
    'боль при жевании',
    'отечность десен',
    'изменение цвета зубов',
    'боль в височно-нижнечелюстном суставе'
        ]
    },
'Реабилитационная система': {
'organs': ['опорно-двигательный аппарат', 'нервная система', 'послеоперационные состояния'],
'symptoms': [
    'ограничение подвижности суставов',
    'мышечная слабость',
    'нарушение координации движений',
    'боли при движении',
    'снижение мышечной силы',
    'нарушение походки',
    'быстрая утомляемость',
    'нарушение баланса',
    'снижение выносливости',
    'послеоперационные боли'
        ]
    },
'Сомнологическая система': {
'organs': ['циркадные ритмы', 'структура сна', 'дыхание во сне'],
'symptoms': [
    'нарушение засыпания',
    'частые пробуждения ночью',
    'дневная сонливость',
    'храп во сне',
    'остановки дыхания во сне',
    'беспокойный сон',
    'кошмарные сновидения',
    'раннее пробуждение',
    'ощущение невыспанности',
    'снижение качества сна'
        ]
    },
'Профессиональные заболевания': {
'organs': ['легкие', 'кожа', 'опорно-двигательный аппарат', 'нервная система'],
'symptoms': [
    'хронический кашель',
    'одышка при нагрузке',
    'кожные высыпания',
    'боли в суставах',
    'мышечная слабость',
    'нарушение слуха',
    'головные боли',
    'повышенная утомляемость',
    'нарушение координации',
    'снижение концентрации'
        ]
    },
'Детские заболевания': {
'organs': ['растущий организм', 'иммунная система', 'нервная система'],
'symptoms': [
    'повышение температуры тела',
    'кашель и насморк',
    'сыпь на коже',
    'снижение аппетита',
    'нарушение сна',
    'повышенная возбудимость',
    'отставание в развитии',
    'частые простудные заболевания',
    'боли в животе',
    'нарушение стула'
        ]
    },
'Возрастные изменения': {
'organs': ['все системы организма', 'когнитивные функции', 'опорно-двигательный аппарат'],
'symptoms': [
    'снижение памяти',
    'ухудшение зрения',
    'нарушение слуха',
    'боли в суставах',
    'снижение мышечной силы',
    'нарушение равновесия',
    'повышенная утомляемость',
    'нарушение мочеиспускания',
    'снижение плотности костей',
    'ухудшение качества кожи'
        ]
    },
'Эстетические проблемы': {
'organs': ['кожа', 'волосы', 'ногти', 'подкожная клетчатка'],
'symptoms': [
    'морщины на коже',
    'пигментные пятна',
    'сосудистые звездочки',
    'целлюлит',
    'выпадение волос',
    'ломкость ногтей',
    'сухость кожи',
    'избыточный вес',
    'растяжки на коже',
    'возрастные изменения лица'
        ]
    },
'Нарушения питания': {
'organs': ['желудочно-кишечный тракт', 'обмен веществ', 'эндокринная система'],
'symptoms': [
    'избыточный вес',
    'недостаточный вес',
    'нарушение аппетита',
    'тяга к определенным продуктам',
    'нарушение пищевого поведения',
    'вздутие живота после еды',
    'изжога и отрыжка',
    'запоры или диарея',
    'отеки',
    'слабость и утомляемость'
        ]
    }
}

doctor_specializations = {
    'Кардиолог': ['сердечно-сосудистая система', 'сердце', 'артерии', 'вены'],
    'Пульмонолог': ['дыхательная система', 'легкие', 'бронхи', 'трахея'],
    'Гастроэнтеролог': ['пищеварительная система', 'желудок', 'кишечник', 'печень'],
    'Нефролог': ['почки', 'мочевыделительная система'],
    'Уролог': ['мочеполовая система', 'мочевой пузырь', 'простата'],
    'Гинеколог': ['женская половая система', 'матка', 'яичники', 'влагалище'],
    'Эндокринолог': ['эндокринная система', 'щитовидная железа', 'надпочечники'],
    'Дерматолог': ['кожа', 'волосы', 'ногти', 'потовые железы'],
    'Офтальмолог': ['глаза', 'органы зрения', 'сетчатка'],
    'Отоларинголог': ['уши', 'нос', 'горло', 'органы слуха'],
    'Невролог': ['нервная система', 'головной мозг', 'спинной мозг'],
    'Ортопед': ['опорно-двигательная система', 'кости', 'суставы'],
    'Ревматолог': ['суставы', 'соединительная ткань', 'аутоиммунные заболевания'],
    'Гематолог': ['кровь', 'костный мозг', 'лимфатическая система'],
    'Онколог': ['опухоли', 'онкологические заболевания', 'рак'],
    'Инфекционист': ['инфекционные заболевания', 'вирусы', 'бактерии'],
    'Аллерголог': ['аллергические реакции', 'иммунная система'],
    'Иммунолог': ['иммунная система', 'иммунодефициты'],
    'Терапевт': ['общие заболевания', 'первичный прием'],
    'Хирург': ['хирургические патологии', 'операции'],
    'Педиатр': ['детские заболевания', 'растущий организм'],
    'Психиатр': ['психические расстройства', 'психическая сфера'],
    'Психотерапевт': ['психологические проблемы', 'эмоциональная сфера'],
    'Стоматолог': ['зубы', 'десны', 'полость рта'],
    'Маммолог': ['молочные железы', 'грудь'],
    'Андролог': ['мужская половая система', 'простата', 'яички'],
    'Диетолог': ['питание', 'обмен веществ', 'нарушения питания'],
    'Физиотерапевт': ['физиотерапия', 'реабилитация'],
    'Реабилитолог': ['реабилитация', 'восстановление', 'опорно-двигательный аппарат'],
    'Сомнолог': ['расстройства сна', 'сомнологическая система'],
    'Флеболог': ['вены', 'варикоз', 'сосудистая система'],
    'Проктолог': ['прямая кишка', 'толстый кишечник'],
    'Гериатр': ['возрастные изменения', 'пожилой возраст'],
    'Спортивный врач': ['спортивные травмы', 'физическая нагрузка'],
    'Профпатолог': ['профессиональные заболевания', 'вредные производства'],
    'Семейный врач': ['семейная медицина', 'общая практика'],
    'Неонатолог': ['новорожденные', 'первые дни жизни'],
    'Подолог': ['стопы', 'ногти на ногах'],
    'Трихолог': ['волосы', 'кожа головы'],
    'Эстетический врач': ['эстетические проблемы', 'косметология'],
    'Кинезиолог': ['движения', 'мышечная система'],
    'Остеопат': ['костная система', 'биомеханика'],
    'Рефлексотерапевт': ['рефлексотерапия', 'биологически активные точки'],
    'Радиолог': ['лучевая диагностика', 'рентген'],
    'Патоморфолог': ['патологическая анатомия', 'биопсии'],
    'Судмедэксперт': ['судебная медицина', 'травмы'],
    'Врач УЗИ': ['ультразвуковая диагностика', 'УЗИ'],
    'Врач функциональной диагностики': ['функциональная диагностика', 'ЭКГ'],
    'Врач ЛФК': ['лечебная физкультура', 'упражнения'],
    'Врач скорой помощи': ['неотложная помощь', 'экстренные состояния']
}

tests_by_organ_system =  {
        'Сердечно-сосудистая система': {
            'common': ['ЭКГ', 'ЭхоКГ', 'Суточное мониторирование ЭКГ', 'Суточное мониторирование АД'],
            'specific': {
                'Кардиолог': ['Коронароангиография', 'Стресс-эхокардиография', 'Велоэргометрия'],
                'Флеболог': ['УЗДГ вен нижних конечностей', 'Флебография', 'Дуплексное сканирование вен']
            }
        },
        'Дыхательная система': {
            'common': ['Рентген грудной клетки', 'Спирометрия', 'КТ органов грудной клетки'],
            'specific': {
                'Пульмонолог': ['Бронхоскопия', 'Исследование функции внешнего дыхания', 'Плевральная пункция'],
                'Аллерголог': ['Аллергопробы', 'Иммуноглобулин E', 'Спирометрия с бронхолитиком']
            }
        },
        'Пищеварительная система': {
            'common': ['УЗИ брюшной полости', 'ФГДС', 'Колоноскопия', 'Биохимический анализ крови'],
            'specific': {
                'Гастроэнтеролог': ['pH-метрия', 'Дыхательный тест на хеликобактер', 'Эластография печени'],
                'Проктолог': ['Ректороманоскопия', 'Аноскопия', 'Ирригоскопия'],
                'Хирург': ['Диагностическая лапароскопия', 'ЭРХПГ']
            }
        },
        'Нервная система': {
            'common': ['МРТ головного мозга', 'ЭЭГ', 'УЗДГ сосудов головы и шеи'],
            'specific': {
                'Невролог': ['Электронейромиография', 'Вызванные потенциалы', 'Люмбальная пункция'],
                'Нейрохирург': ['КТ головного мозга с контрастом', 'Ангиография сосудов мозга']
            }
        },
        'Опорно-двигательная система': {
            'common': ['Рентген суставов', 'МРТ позвоночника', 'Денситометрия'],
            'specific': {
                'Ортопед': ['Артроскопия', 'КТ суставов', 'УЗИ суставов'],
                'Ревматолог': ['Анализ на ревматоидный фактор', 'АЦЦП', 'С-реактивный белок'],
                'Травматолог': ['КТ костей', 'МРТ мягких тканей']
            }
        },
        'Мочеполовая система': {
            'common': ['УЗИ почек', 'УЗИ мочевого пузыря', 'Общий анализ мочи'],
            'specific': {
                'Уролог': ['Цистоскопия', 'Урофлоуметрия', 'Анализ секрета простаты'],
                'Нефролог': ['Проба Реберга', 'Суточный анализ мочи', 'Биопсия почки'],
                'Гинеколог': ['УЗИ малого таза', 'Кольпоскопия', 'Мазок на флору']
            }
        },
        'Эндокринная система': {
            'common': ['Анализ крови на гормоны', 'УЗИ щитовидной железы', 'Глюкоза крови'],
            'specific': {
                'Эндокринолог': ['Гликированный гемоглобин', 'Тест на толерантность к глюкозе', 'Кортизол'],
                'Диетолог': ['Биоимпедансометрия', 'Липидный профиль', 'Инсулин']
            }
        },
        'Кожа и придатки': {
            'common': ['Соскоб с кожи', 'Дерматоскопия', 'Общий анализ крови'],
            'specific': {
                'Дерматолог': ['Биопсия кожи', 'Посев на грибы', 'Аллергопатчи'],
                'Трихолог': ['Трихоскопия', 'Фототрихограмма', 'Анализ волос на микроэлементы'],
                'Подолог': ['Соскоб с ногтей', 'Микологический посев']
            }
        },
        'Органы чувств': {
            'common': ['Визометрия', 'Тонометрия', 'Аудиометрия'],
            'specific': {
                'Офтальмолог': ['ОКТ сетчатки', 'Периметрия', 'Биомикроскопия'],
                'Отоларинголог': ['Эндоскопия ЛОР-органов', 'Тимпанометрия', 'Вестибулометрия']
            }
        },
        'Иммунная система': {
            'common': ['Иммунограмма', 'Общий анализ крови', 'С-реактивный белок'],
            'specific': {
                'Иммунолог': ['Интерфероновый статус', 'Анализ на цитокины', 'Тест на фагоцитоз'],
                'Аллерголог': ['Иммуноглобулин E', 'Тест на специфические IgE', 'Кожные пробы']
            }
        },
        'Женская половая система': {
            'common': ['УЗИ малого таза', 'Мазок на цитологию', 'Анализ на половые гормоны'],
            'specific': {
                'Гинеколог': ['Гистероскопия', 'Кольпоскопия', 'Анализ на ИППП'],
                'Маммолог': ['Маммография', 'УЗИ молочных желез', 'Биопсия молочной железы']
            }
        },
        'Мужская половая система': {
            'common': ['УЗИ предстательной железы', 'Анализ секрета простаты', 'Спермограмма'],
            'specific': {
                'Уролог': ['ТРУЗИ', 'Анализ на ПСА', 'Биопсия простаты'],
                'Андролог': ['MAR-тест', 'Анализ фрагментации ДНК сперматозоидов', 'Гормональный профиль']
            }
        },
        'Кровь и кроветворная система': {
            'common': ['Общий анализ крови', 'Коагулограмма', 'Биохимический анализ крови'],
            'specific': {
                'Гематолог': ['Стернальная пункция', 'Трепанобиопсия', 'Проточная цитометрия'],
                'Трансфузиолог': ['Проба Кумбса', 'Определение группы крови и резус-фактора']
            }
        },
        'Психическая сфера': {
            'common': ['ЭЭГ', 'МРТ головного мозга', 'Общий анализ крови'],
            'specific': {
                'Психиатр': ['Психологическое тестирование', 'Электроэнцефалография', 'Токсикологический анализ'],
                'Психотерапевт': ['Проективные тесты', 'Опросники тревоги и депрессии']
            }
        },
        'Стоматологическая система': {
            'common': ['Ортопантомограмма', 'КТ челюстей', 'Бактериологический посев'],
            'specific': {
                'Стоматолог': ['Витальное окрашивание зубов', 'ЭОД', 'Пародонтальный индекс'],
                'Ортодонт': ['Телерентгенограмма', 'Анализ моделей челюстей']
            }
        },
        'Реабилитационная система': {
            'common': ['Функциональные пробы', 'ЭНМГ', 'Стабилометрия'],
            'specific': {
                'Физиотерапевт': ['Электромиография', 'Гониометрия', 'Тест мышечной силы'],
                'Реабилитолог': ['Анализ походки', 'Баланс-тест', 'Кардиопульмональный тест']
            }
        },
        'Сомнологическая система': {
            'common': ['Полисомнография', 'ЭЭГ ночного сна', 'Пульсоксиметрия'],
            'specific': {
                'Сомнолог': ['MSLT-тест', 'Респираторный мониторинг', 'Актиграфия']
            }
        },
        'Профессиональные заболевания': {
            'common': ['Спирометрия', 'Аудиометрия', 'Рентген органов грудной клетки'],
            'specific': {
                'Профпатолог': ['Анализ на тяжелые металлы', 'Пылевой анализ', 'Виброметрия']
            }
        },
        'Детские заболевания': {
            'common': ['Общий анализ крови', 'Общий анализ мочи', 'УЗИ органов брюшной полости'],
            'specific': {
                'Педиатр': ['Неонатальный скрининг', 'Анализ на дисбактериоз', 'Копрограмма'],
                'Неонатолог': ['Анализ крови новорожденного', 'Билирубин', 'Газовый состав крови']
            }
        },
        'Возрастные изменения': {
            'common': ['Денситометрия', 'Липидный профиль', 'Глюкоза крови'],
            'specific': {
                'Гериатр': ['Когнитивные тесты', 'Анализ на витамин D', 'Оценка функционального статуса']
            }
        },
        'Эстетические проблемы': {
            'common': ['Дерматоскопия', 'Фототипирование кожи', 'Анализ на гормоны'],
            'specific': {
                'Эстетический врач': ['Анализ состояния кожи', 'Тест на фотостарение', 'Оценка пропорций лица']
            }
        },
        'Нарушения питания': {
            'common': ['Биохимический анализ крови', 'Липидный профиль', 'Гормональный профиль'],
            'specific': {
                'Диетолог': ['Биоимпедансный анализ', 'Калориметрия', 'Анализ основного обмена']
            }
        }
}
test_costs = {
    # Общие анализы
    'Общий анализ крови': 500,
    'Общий анализ мочи': 400,
    'Биохимический анализ крови': 1200,
    'Коагулограмма': 800,
    'Липидный профиль': 900,
    'Глюкоза крови': 300,
    
    # Кардиология
    'ЭКГ': 700,
    'ЭхоКГ': 2500,
    'Суточное мониторирование ЭКГ': 3500,
    'Суточное мониторирование АД': 3000,
    'Коронароангиография': 25000,
    'Стресс-эхокардиография': 4500,
    'Велоэргометрия': 2000,
    'УЗДГ вен нижних конечностей': 1800,
    'Флебография': 5000,
    'Дуплексное сканирование вен': 2200,
    
    # Дыхательная система
    'Рентген грудной клетки': 1500,
    'Спирометрия': 1200,
    'КТ органов грудной клетки': 4500,
    'Бронхоскопия': 6000,
    'Исследование функции внешнего дыхания': 1500,
    'Плевральная пункция': 3500,
    'Аллергопробы': 2500,
    'Иммуноглобулин E': 800,
    'Спирометрия с бронхолитиком': 1800,
    
    # Пищеварительная система
    'УЗИ брюшной полости': 2000,
    'ФГДС': 3000,
    'Колоноскопия': 6000,
    'pH-метрия': 2500,
    'Дыхательный тест на хеликобактер': 1200,
    'Эластография печени': 3500,
    'Ректороманоскопия': 2500,
    'Аноскопия': 1500,
    'Ирригоскопия': 4000,
    'Диагностическая лапароскопия': 15000,
    'ЭРХПГ': 12000,
    
    # Нервная система
    'МРТ головного мозга': 6000,
    'ЭЭГ': 1500,
    'УЗДГ сосудов головы и шеи': 2200,
    'Электронейромиография': 3500,
    'Вызванные потенциалы': 2000,
    'Люмбальная пункция': 4000,
    'КТ головного мозга с контрастом': 8000,
    'Ангиография сосудов мозга': 12000,
    
    # Опорно-двигательная система
    'Рентген суставов': 1200,
    'МРТ позвоночника': 7000,
    'Денситометрия': 2000,
    'Артроскопия': 15000,
    'КТ суставов': 4500,
    'УЗИ суставов': 1800,
    'Анализ на ревматоидный фактор': 600,
    'АЦЦП': 1200,
    'С-реактивный белок': 500,
    'КТ костей': 4000,
    'МРТ мягких тканей': 5000,
    
    # Мочеполовая система
    'УЗИ почек': 1500,
    'УЗИ мочевого пузыря': 1200,
    'Цистоскопия': 3500,
    'Урофлоуметрия': 1000,
    'Анализ секрета простаты': 700,
    'Проба Реберга': 800,
    'Суточный анализ мочи': 600,
    'Биопсия почки': 8000,
    'УЗИ малого таза': 1800,
    'Кольпоскопия': 1500,
    'Мазок на флору': 400,
    
    # Эндокринная система
    'Анализ крови на гормоны': 1500,
    'УЗИ щитовидной железы': 1500,
    'Гликированный гемоглобин': 600,
    'Тест на толерантность к глюкозе': 800,
    'Кортизол': 700,
    'Биоимпедансометрия': 1200,
    'Инсулин': 800,
    
    # Кожа и придатки
    'Соскоб с кожи': 500,
    'Дерматоскопия': 800,
    'Биопсия кожи': 2500,
    'Посев на грибы': 900,
    'Аллергопатчи': 2000,
    'Трихоскопия': 1200,
    'Фототрихограмма': 1500,
    'Анализ волос на микроэлементы': 1800,
    'Соскоб с ногтей': 500,
    'Микологический посев': 900,
    
    # Органы чувств
    'Визометрия': 300,
    'Тонометрия': 400,
    'Аудиометрия': 800,
    'ОКТ сетчатки': 2000,
    'Периметрия': 900,
    'Биомикроскопия': 600,
    'Эндоскопия ЛОР-органов': 1800,
    'Тимпанометрия': 700,
    'Вестибулометрия': 1200,
    
    # Иммунная система
    'Иммунограмма': 3500,
    'С-реактивный белок': 500,
    'Интерфероновый статус': 2000,
    'Анализ на цитокины': 2500,
    'Тест на фагоцитоз': 1500,
    'Иммуноглобулин E': 800,
    'Тест на специфические IgE': 3000,
    'Кожные пробы': 2000,
    
    # Женская половая система
    'Мазок на цитологию': 600,
    'Анализ на половые гормоны': 1800,
    'Гистероскопия': 6000,
    'Анализ на ИППП': 2500,
    'Маммография': 2500,
    'УЗИ молочных желез': 1500,
    'Биопсия молочной железы': 5000,
    
    # Мужская половая система
    'УЗИ предстательной железы': 1500,
    'Спермограмма': 1200,
    'ТРУЗИ': 2000,
    'Анализ на ПСА': 800,
    'Биопсия простаты': 7000,
    'MAR-тест': 1500,
    'Анализ фрагментации ДНК сперматозоидов': 3500,
    'Гормональный профиль': 2000,
    
    # Кровь и кроветворная система
    'Стернальная пункция': 6000,
    'Трепанобиопсия': 8000,
    'Проточная цитометрия': 5000,
    'Проба Кумбса': 900,
    'Определение группы крови и резус-фактора': 500,
    
    # Психическая сфера
    'Психологическое тестирование': 2000,
    'Электроэнцефалография': 1500,
    'Токсикологический анализ': 2500,
    'Проективные тесты': 1500,
    'Опросники тревоги и депрессии': 800,
    
    # Стоматологическая система
    'Ортопантомограмма': 1200,
    'КТ челюстей': 3500,
    'Бактериологический посев': 900,
    'Витальное окрашивание зубов': 400,
    'ЭОД': 600,
    'Пародонтальный индекс': 300,
    'Телерентгенограмма': 1500,
    'Анализ моделей челюстей': 2000,
    
    # Реабилитационная система
    'Функциональные пробы': 800,
    'ЭНМГ': 3000,
    'Стабилометрия': 1500,
    'Электромиография': 2000,
    'Гониометрия': 600,
    'Тест мышечной силы': 500,
    'Анализ походки': 1200,
    'Баланс-тест': 900,
    'Кардиопульмональный тест': 2500,
    
    # Сомнологическая система
    'Полисомнография': 8000,
    'ЭЭГ ночного сна': 3500,
    'Пульсоксиметрия': 600,
    'MSLT-тест': 4500,
    'Респираторный мониторинг': 3000,
    'Актиграфия': 2000,
    
    # Профессиональные заболевания
    'Анализ на тяжелые металлы': 2000,
    'Пылевой анализ': 1500,
    'Виброметрия': 1200,
    
    # Детские заболевания
    'Неонатальный скрининг': 1500,
    'Анализ на дисбактериоз': 1200,
    'Копрограмма': 600,
    'Анализ крови новорожденного': 800,
    'Билирубин': 400,
    'Газовый состав крови': 900,
    
    # Возрастные изменения
    'Когнитивные тесты': 1500,
    'Анализ на витамин D': 1000,
    'Оценка функционального статуса': 1200,
    
    # Эстетические проблемы
    'Фототипирование кожи': 800,
    'Анализ состояния кожи': 1200,
    'Тест на фотостарение': 1500,
    'Оценка пропорций лица': 2000,
    
    # Нарушения питания
    'Биоимпедансный анализ': 1200,
    'Калориметрия': 1800,
    'Анализ основного обмена': 1500
}

from datetime import datetime, timedelta
import random

def get_all_organs():
    organs = set()
    for system in organ_systems.values():
        organs.update(system['organs'])
    return list(organs)

def get_all_symptoms():
    symptoms = set()
    for system in organ_systems.values():
        symptoms.update(system['symptoms'])
    return list(symptoms)

def get_organs_by_symptom(symptom: str):
    organs = set()
    for system in organ_systems.values():
        if symptom in system['symptoms']:
            organs.update(system['organs'])
    return list(organs)

def get_doctors_by_organ(organ: str):
    doctors = set()
    for doctor, organs in doctor_specializations.items():
        if organ in organs:
            doctors.add(doctor)
    return list(doctors)

def get_doctors_by_most_symptoms(symptoms: list):
    doctor_count = {}
    for symptom in symptoms:
        organs = get_organs_by_symptom(symptom)
        for organ in organs:
            doctors = get_doctors_by_organ(organ)
            for doctor in doctors:
                if doctor not in doctor_count:
                    doctor_count[doctor] = 0
                doctor_count[doctor] += 1
    max_count = max(doctor_count.values(), default=0)
    best_doctors = [doc for doc, count in doctor_count.items() if count == max_count]
    return best_doctors

def get_tests_by_symptoms_and_doctor(symptoms: list[str], doctor: str):
    possible_tests = set()
    symptom_systems = set()
    doctor_systems = set()

    for symptom in symptoms:
        for system_name, system_details in organ_systems.items():
            if symptom in system_details['symptoms']:
                symptom_systems.add(system_name)

    if doctor in doctor_specializations:
        specialties = doctor_specializations[doctor]
        for specialty in specialties:
            if specialty in organ_systems:
                doctor_systems.add(specialty)
            else:
                for system_name, system_details in organ_systems.items():
                    if specialty in system_details['organs']:
                        doctor_systems.add(system_name)

    relevant_systems = symptom_systems.intersection(doctor_systems)

    if not relevant_systems:
        relevant_systems = doctor_systems

    for system_name in relevant_systems:
        if system_name in tests_by_organ_system:
            possible_tests.update(tests_by_organ_system[system_name].get('common', []))
            if doctor in tests_by_organ_system[system_name].get('specific', {}):
                possible_tests.update(tests_by_organ_system[system_name]['specific'][doctor])

    return list(possible_tests)

def generate_visit_date(base_year=2020):
    start_date = datetime(base_year, 1, 1)
    end_date = datetime(base_year, 12, 31)
    
    days_between = (end_date - start_date).days
    random_days = random.randint(0, days_between)
    visit_date = start_date + timedelta(days=random_days)
    
    hour = random.randint(8, 17)
    minute = random.choice([0, 30])
    visit_date = visit_date.replace(hour=hour, minute=minute)
    
    days_to_results = random.randint(1, 3)
    results_date = visit_date + timedelta(days=days_to_results)
    
    results_hour = random.randint(9, 15)
    results_minute = random.choice([0, 30])
    results_date = results_date.replace(hour=results_hour, minute=results_minute)
    
    min_cost = 500
    max_cost = 5000
    step = 100
    cost = random.randrange(min_cost, max_cost + step, step)
    
    visit_date_str = visit_date.strftime('%Y-%m-%dT%H:%M+03:00')
    results_date_str = results_date.strftime('%Y-%m-%dT%H:%M+03:00')
    
    return {
        'Дата визита': visit_date_str,
        'Дата готовности анализов': results_date_str,
        'Стоимость анализов': cost
    }

def calculate_total_test_cost(tests_list):
    total_cost = 0
    for test in tests_list:
        if test in test_costs:
            total_cost += test_costs[test]
        else:
            total_cost += 1000
    return total_cost

def create_random_patient_profile():
    system_names = list(organ_systems.keys())
    selected_systems = random.sample(system_names, 2)
    
    symptoms = []
    all_symptoms_from_selected = []
    for system in selected_systems:
        all_symptoms_from_selected.extend(organ_systems[system]['symptoms'])
    
    if len(all_symptoms_from_selected) >= 3:
        symptoms = random.sample(all_symptoms_from_selected, 3)
    else:
        symptoms = all_symptoms_from_selected[:]
        remaining_systems = [sys for sys in system_names if sys not in selected_systems]
        additional_symptoms = []
        for system in remaining_systems:
            additional_symptoms.extend(organ_systems[system]['symptoms'])
        
        needed_count = 3 - len(symptoms)
        if needed_count > 0 and additional_symptoms:
            additional_selected = random.sample(additional_symptoms, min(needed_count, len(additional_symptoms)))
            symptoms.extend(additional_selected)
    
    symptoms = symptoms[:3]
    doctors = get_doctors_by_most_symptoms(symptoms)
    
    primary_doctor = None
    primary_tests = []

    if doctors:
        primary_doctor = random.choice(doctors)
        all_tests = get_tests_by_symptoms_and_doctor(symptoms, primary_doctor)
        if all_tests:
            num_tests = random.randint(1, min(3, len(all_tests)))
            primary_tests = random.sample(all_tests, num_tests)
        else:
            primary_tests = ["Общий анализ крови", "Общий анализ мочи"]
    else:
        primary_doctor = 'Терапевт'
        all_tests = get_tests_by_symptoms_and_doctor(symptoms, primary_doctor)
        if all_tests:
            num_tests = random.randint(1, min(3, len(all_tests)))
            primary_tests = random.sample(all_tests, num_tests)
        else:
            primary_tests = ["Общий анализ крови", "Общий анализ мочи"]
    
    date = generate_visit_date()
    total_cost = calculate_total_test_cost(primary_tests)
    
    profile = {
        'Симптомы': ', '.join(symptoms),
        'Врач': primary_doctor,
        'Дата посещения врача': date['Дата визита'],
        'Анализы': ', '.join(primary_tests),
        'Дата готовности анализов': date['Дата готовности анализов'],
        'Стоимость анализов': total_cost    
    }
    
    return profile